# A namespace that contains all the strings of SQL commands as executable methods

module SQLCommands

  # Used to get sites that are particular pricing models
  # because you can specify that the pricing amount is
  # NOT zero.
  def get_site_ids_with_pricing(pricing, amount, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT siteId
                    FROM site_data
                    WHERE #{pricing} IS NOT "#{amount}"
                    AND siteId IN (SELECT siteId
                                    FROM creative_data);|)
  end

  def get_site_ids_in_creative_data(as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT siteId
                  FROM site_data
                  WHERE siteId
                  IN (SELECT siteId
                        FROM creative_data);|)
  end

  def get_test_site_data(sites_array, as_hash=true)
    self.results_as_hash = as_hash
    self.execute(%|SELECT s.name site_name, s.siteId, s.url, c.name campaign_name,
                    c.campaignId, s.cpm, s.cpa, s.revenueShare,
                    s.cpc, s.cpe, s.advertiserId, s.abTestPerc
                    FROM site_data s, campaign_data c
                    WHERE c.siteId = s.siteId
	                  AND c.campaignId
		                IN (SELECT campaignId FROM creative_data)
	                  AND s.siteId
		                IN (#{sites_array.join(", ")});|)
  end

  def get_loyalty_site_date(sites_array, as_hash=true)
    self.results_as_hash = as_hash
    self.execute(%|SELECT siteId, name, url, cpa, cpe, cpm, cpc, revenueShare, abTestPerc
	                  FROM site_data
	                  WHERE siteId
	                  IN (#{sites_array.join(", ")});|)
  end

  def get_data_for_a_campaign(campaign_name, site_name, as_hash=true)
    self.results_as_hash = as_hash
    self.execute(%|SELECT s.name site_name, s.siteId, s.url, c.name campaign_name, c.campaignId,
	                  s.cpm, s.cpa, s.revenueShare, s.cpc, s.cpe, s.advertiserId, s.abTestPerc
                    FROM site_data s, campaign_data c
                    WHERE c.siteId = s.siteId
	                  AND c.name = "#{campaign_name}"
	                  AND s.name = "#{site_name}";|)
  end

  def get_product_url(site_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT url
                    FROM product_links
                    WHERE siteId = '#{site_id}';|)[0][0]
  end

  def get_keywords_by_campaign_id(campaign_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT keyword
                    FROM keywords
                    WHERE campaignId = "#{campaign_id}"
                    AND checksum = "";|)
  end

  def get_full_kwds_by_camp_id(campaign_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT DISTINCT full_keyword
                    FROM keywords
                    WHERE campaignId = "#{campaign_id}"
                    AND full_keyword IS NOT NULL;|)
  end

  def get_ad_tag_data(test_tag, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT cpm, name, primaryId
                    FROM network_adtag_data
                    WHERE networkAdTagId = "#{test_tag}";|)[0]
  end

  def get_creatives(campaign_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT creativeId
                    FROM creative_data
                    WHERE campaignId = "#{campaign_id}";|).flatten!
  end

  def get_creatives_by_site_and_camp(site_id, camp_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT creativeId
                    FROM creative_data
                    WHERE siteId = "#{site_id}"
                    AND campaignId = "#{camp_id}";|)
  end

  def get_campaign_from_creative(creative_id, as_hash=false)
    self.results_as_hash = as_hash
    begin
      self.execute(%|SELECT campaignId
                    FROM creative_data
                    WHERE creativeId = "#{creative_id}";|)[0][0]
    rescue
      puts "Unable to find the campaign associated with this creative: #{creative_id}!!"
    end
  end

  def get_cpid_from_sid_and_cpname(site_id, camp_name, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT campaignId
                    FROM campaign_data
                    WHERE siteId = "#{site_id}"
                    AND name = "#{camp_name}";|)[0][0]
  end

  def get_camp_names_by_sid(site_id, as_hash=true)
    self.results_as_hash = as_hash
    self.execute(%|SELECT name
		                FROM campaign_data
		                WHERE siteId = "#{site_id}";|)
  end

  def get_spb_for_campaign(campaign_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT showPopularBrowsed
                    FROM site_data
                    WHERE siteId
                    IN (SELECT siteId
                          FROM campaign_data
                          WHERE campaignId = "#{campaign_id}");|)[0][0]
  end

  def get_product_url_for_site(site_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT url, campaignId
                    FROM product_links
                    WHERE siteId != "#{site_id}";|)
  end

  def get_ad_tags_for_campaign(campaign_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT networkAdTagId
                    FROM network_adtag_data
                    WHERE campaignId = "#{campaign_id}";|)
  end

  def get_ad_tag_ids_by_site_id(site_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT networkAdTagId
                    FROM network_adtag_data
                    WHERE siteId = "#{site_id}";|)
  end

  def get_ad_tags_by_site_and_camp(site_id, camp_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT networkAdTagId
		                FROM network_adtag_data
		                WHERE siteId = "#{site_id}"
		                AND campaignId = "#{camp_id}";|)
  end

  def get_sites_with_control_camps(as_hash=false)
  self.results_as_hash = as_hash
    self.execute(%|SELECT siteId
                    FROM campaign_data
                    WHERE name = "control";|)
  end

  def get_control_site_data(control_sites, as_hash=true)
    self.results_as_hash = as_hash
    self.execute(%|SELECT siteId, name site_name, url, cpa, cpe, cpm, cpc, revenueShare, abTestPerc
	                  FROM site_data
	                  WHERE siteId
	                  IN (#{control_sites.join(", ")});|)
  end

  def get_control_camp_id(site_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT campaignID
                    FROM campaign_data
                    WHERE siteId = "#{site_id}"
                    AND name = "control";|)[0][0]
  end

  def get_non_landing_campaign_data(site_id, as_hash=true)
    self.results_as_hash = as_hash
    self.execute(%|SELECT name campaign_name, campaignId
	                  FROM campaign_data
	                  WHERE siteId = "#{site_id}"
	                  AND NOT (name = "landing" AND performanceWeight == "0.0000");|)
  end

  def get_network_cpm(ad_tag_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT cpm
                    FROM network_adtag_data
                    WHERE networkAdTagId = "#{ad_tag_id}";|)[0][0]
  end

  def get_account_id_for_site(site_id, as_hash=false)
    self.results_as_hash = as_hash
    self.execute(%|SELECT advertiserId
                    FROM site_data
                    WHERE siteId = "#{site_id}";|)[0][0]
  end

  def get_site_ids_for_loyalty_camps(as_hash=false)
  self.results_as_hash = as_hash
    self.execute(%|SELECT DISTINCT siteId
                    FROM creative_data
                    WHERE campaignId
                    IN (SELECT campaignId
                        FROM campaign_data
                        WHERE name = "loyalty.campaign");|)
  end

  def get_cukov_data_by_site_name(site_name, as_hash=true)
    self.results_as_hash = as_hash
    self.execute(%|SELECT siteId, name, cookieOverride, showPopularBrowsed
		                FROM site_data
		                WHERE name = "#{site_name}";|)
  end

  def get_cukov_by_co_and_spb(cookie_override, show_ppl_browsed, as_hash=true)
    self.results_as_hash = as_hash
    self.execute(%|SELECT siteId, name, cookieOverride, showPopularBrowsed
		                FROM site_data
		                WHERE cookieOverride = '#{cookie_override}'
		                AND showPopularBrowsed = '#{show_ppl_browsed}';|)
  end

end
